<html>
	<head>
<<<<<<< HEAD
		
	</head>
	<body>
		See your console.

		<script type="text/javascript">
		/**
		 *
		 * Copyright (C) 2012 by Scott Byrns
		 * http://github.com/scottbyrns
		 *
		 * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with
		 * the License. You may obtain a copy of the License at
		 *
		 *     http://www.apache.org/licenses/LICENSE-2.0
		 *
		 * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on
		 * an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the
		 * specific language governing permissions and limitations under the License.
		 *
		 */

		__GLOBAL_NAMESPACE__ = window;

		Object.prototype.setType = function (type) {
			this.objectType = type;
			return this;
		};

		Object.prototype.checkType = function (object) {
			var type = object;
			if (type == this.objectType) {
				return this;
			}
			throw new Error("Object of type: " + type + " found, expected object of type: " + this.objectType);
		};

		Object.prototype.getType = function () {
			if (this.objectType === "undefined") {
				this.objectType = typeof this;
			}
			return this.objectType;
		};

		Function.prototype.checkType = function () {
			for (var i = 0; i < arguments.length; i += 1) {
				var type = (typeof arguments[i]);
				try {
					arguments[i].getType();
				}
				catch (e) {
					// No type probabbly a primative.
				}
				if (this.interface['input-parameters'][i].type != type) {
					throw new Error("Expected value of type: " + this.interface['input-parameters'][i].type + " but found value of type: " + type + ' for argument named: ' + this.interface['input-parameters'][i].name);
				}
			}
			return true;
		}

		Function.prototype.setInterface = Object.prototype.setInterface = function (interface) {
			this.interface = interface;
		};

		Function.prototype.getInterface = Object.prototype.getInterface = function () {
			return this.interface;
		};


		Function.prototype.isImplementationOf = Object.prototype.isImplementationOf = function (object) {
			try {
				return this.checkInterfaceAgainst(object);
			}
			catch (e) {
				return false;
			}
		};

		Function.prototype.checkInterfaceAgainst = Object.prototype.checkInterfaceAgainst = function (object) {
			if (this.interface == undefined && object && object.interface) {
				throw new Error("Interface was not defined.");
			}
			if (object.interface) {
				if (object.interface['input-parameters'] && this.interface['input-parameters']) {
					for (
						var valueIndex = 0, valueLength = this.interface['input-parameters'].length;
						valueIndex < valueLength;
						valueIndex += 1
					)
					{
						if (this.interface['return-value'].type != object.interface['return-value'].type) {
							throw new Error([
								"Provided object does not return a value of type: ",
								this.interface['return-value'].type
							].join(""));
						}
						if (this.interface['input-parameters'][valueIndex].name != object.interface['input-parameters'][valueIndex].name) {
							throw new Error([
								"Provided object does accept argument named: ",
								this.interface['input-parameters'][valueIndex].name,
								'.'
							].join(''));
						}
						if (this.interface['input-parameters'][valueIndex].type != object.interface['input-parameters'][valueIndex].type) {
							throw new Error([
								"Provided object does accept argument named: ",
								this.interface['input-parameters'][valueIndex].name,
								' of type ',
								this.interface['input-parameters'][valueIndex].type,
								'.'
							].join(''));
						}
					}
				}
				else {
					throw new Error("No interface was defined.");
				}
			}
			return true;
		};

		var TypeSafeClass = function (global) {
			var classRegister = {};

			return function (config) {


				var theClass = function (config) {
					// Creating an access controll list for restricting method access.
					var methodAccessControlList = {};
					var methodInterfaces = Interface.getInterfaceNamed(config.implements).methods;
					for (var mii = 0; mii < methodInterfaces.length; mii += 1) {
						var method = methodInterfaces[mii];
						methodAccessControlList[method.name] = {scope:method.interface.scope, uid:new Date().getTime()} || {scope:'public', uid:new Date().getTime()};
					}
					return function () {
						if (this == __GLOBAL_NAMESPACE__) {
							throw new Error("No static constructor is available for this type safe class.");
						}
						try {
							this.setType(config.type);
							config.constructor.setInterface(Interface.getInterfaceNamed(config.implements).getConstructor());
							config.constructor.checkType.apply(arguments);
							config.constructor.apply(this, arguments);
							this.setInterface(Interface.getInterfaceNamed(config.implements));
						}
						catch (e) {
							throw new Error("No static constructor is available for this type safe class.")
						}
						this.getAccessControlList = function (internalCall) {
							if (internalCall) {

							}
							return methodAccessControlList;
						}
					}
				}(config);
				theClass.setInterface(Interface.getInterfaceNamed(config.implements));

				var properties = config.properties;
				for (propertyIndex in properties) {
					if (properties.hasOwnProperty(propertyIndex)) {
						var txt = properties[propertyIndex].name;
						var type = properties[propertyIndex].type;
						var camelCasedMethodName = txt.substr(0, 1).toUpperCase() + txt.substr(1, txt.length);
						theClass.prototype['get' + camelCasedMethodName] = function () {
							return this[txt];
						};
						theClass.prototype['set' + camelCasedMethodName] = function (typedValue) {
							var inputType = (typeof typedValue);
							if (typedValue.getType && typedValue.getType() != undefined) {
								inputType = typedValue.getType();						
							}
							try {
								if (inputType == type) {
									this[txt] = arguments[0];
								}
								else {
									throw new Error("Expected value of type: " + type + " but found value of type: " + inputType);
								}
							}
							catch (e) {
								throw new Error(e);
								throw new Error("Setting typed value with untyped parameter.");
							}
						};
					}
				}

				var methods = Interface.getInterfaceNamed(config.implements).getMethods();

				for (methodId in methods) {
					if (!methods.hasOwnProperty(methodId)) {
						continue;
					}
					var method = methods[methodId];
					theClass.prototype[method.name] = function (method) {
						if (config[method.name]) {
							config[method.name].setInterface(method.interface);
							var operation = function () {
								var allGo = config[method.name].checkType.apply(arguments);
								if (this.getAccessControlList()[method.name].scope == 'private') {
									if (this.uid != this.getAccessControlList()[method.name].uid) {
										throw new Error("Access violation. Call to private method.");
									}
								}
								if (allGo) {
									// Issue UID to our object.
									this.uid = this.getAccessControlList()[method.name].uid;
									var output = config[method.name].apply(this, arguments);
									// Strip the UID now that our method call is finished.
									this.uid = undefined;
									return output;
								}
							};
							operation.setInterface(method.interface);
							return operation;
						}
						else {
							throw new Error("Class does not implement " + method.name);
						}
					}(method);

				}

				classRegister[config.type] = theClass;

				var typePath = config.type.split('.');
				var depth = global;

				for (var i = 0; i < typePath.length - 1; i += 1) {
					depth = depth[typePath[i]] = depth[typePath[i]] || {};
				}

				depth[typePath[typePath.length - 1]] = theClass;

				return theClass;
			};
		}(__GLOBAL_NAMESPACE__);

		var Interface = function () {
			var interfaceRegister = {

			};
			var Interface = function (config) {
				this.setType(config.type);
				this.constructor = config.constructor;
				this.methods = config.methods;
				interfaceRegister[config.type] = this;
			};

			Interface.prototype.getConstructor = function () {
				return this.constructor;
			};

			Interface.prototype.getMethods = function () {
				return this.methods;
			};

			Interface.prototype.toXML = function () {

			};

			Interface.prototype.toJSON = function () {

			};

			Interface.prototype.toJava = function () {
				var outputObject = {
					type: this.getType(),
					constructor: this.constructor,
					methods: this.methods
				};
			};

			Interface.getInterfaceNamed = function (name) {
				return interfaceRegister[name];
			}
			return Interface;
		}();


		new Interface({
			type: "com.example.IntegerInterface",
			constructor: {
				'return-value': {
					type: 'com.example.Integer'
				},
				'input-parameters': [
					{
						name: 'factor',
						type: 'number'
					}
				]
			},
			methods: [
			{
				name: "multiplyBy",
				interface: {
					'scope': 'public',
					'return-value': {
						type: 'com.example.Integer'
					},
					'input-parameters': [
						{
							name: 'factor',
							type: 'com.example.Integer'
						}
					]
				}
			},
			{
				name: "doMultiply",
				interface: {
					'scope': 'private',
					'return-value': {
						type: 'com.example.Integer'
					},
					'input-parameters': [
						{
							name: 'factor',
							type: 'com.example.Integer'
						}
					]
				}
			}
			]
		});

		new TypeSafeClass({
			type: 'com.example.Integer',
			implements: 'com.example.IntegerInterface',
			constructor: function (value) {
				this.setValue(value || 0);
			},
			properties: [
				{
					name: 'value',
					type: 'number'
				}
			],
			multiplyBy: function (factor) {
				return this.doMultiply(factor);
			},
			doMultiply: function (factor) {
				return new com.example.Integer(this.getValue() * factor.getValue());
			}
		});

		var rows = new com.example.Integer(2);
		var columns = new com.example.Integer(7);
		columns.setValue(12);

		var cells = rows.multiplyBy(columns);
		cells.getValue(); // 24

		console.log("Welcome. For help type help.");
		var TAB = "     ";
		help = [
			"",
			"TypeSafe.js",
			"",
			"TypeSafe.js introduces some fundamental changes to the prototypes of Object and Function.",
			"These changes are designed to allow us to track the types of objects.",
			"",
			"",
			"To begin you can create a new instance of com.example.Integer by typing:",
			TAB + "var myInt = new com.example.Integer(2);",
			"",
			"",
			"You can call the public method Integer#multiplyBy(Integer factor) as defined",
			"by its interface which can bee seen by calling:",
			TAB + "com.example.Integer.getInterface()",
			"",
			"",
			"For instructions on how to define an interface type interfaces.",
			"For instructions on defining a new type safe class type helloworld",
			"",
			"",
			"Commands",
			"",
			TAB + " * help",
			TAB + " * interfaces",
			TAB + " * helloworld",
			""
		].join("\n");
		
		helloworld = [
			"",
			"Hello World in TypeSafe.js",
			"",
			"Each type safe object requires an interface definition.",
			"To learn about defining interfaces type interfaces.",
			"",
			"Once you have defined an interface you can define an implementing",
			"class. You do not need to hold onto a reference to the interface.",
			"",
			"A class is defined in 5 parts.",
			"",
			"",
			TAB + " * Type - The name including namespace of your class.",
			TAB + TAB + " The name is split on . and namespaces are created for you.",
			"",
			TAB + " * Implements - The type you defined for your interface. (same string)",
			"",
			TAB + " * Constructor - The method that is called when your object is created.",
			"",
			TAB + " * Properties - The properties held by your class and their types.",
			TAB + "                TypeSafe getters and setters are automatically generated for",
			TAB + "                these properties.",
			"",
			TAB + " * Methods - Every method defined in your interface must be implemented",
			TAB + "             in your class configuration object. Place each method as a",
			TAB + "             properties of your configuration. There is no parent node for methods.",
			"",
			"",
			"",
			"Example:",
			TAB + 'new TypeSafeClass({',
			TAB + '	type: "com.example.HelloWorld",',
			TAB + '	implements: "com.example.HelloWorld",',
			TAB + '	constructor : function () {},',
			TAB + '	properties: {},',
			TAB + '	live: function () {',
			TAB + '		alert("hello world");',
			TAB + '	}',
			TAB + '});',
			TAB + '',
			TAB + 'var ourWorld = new com.example.HelloWorld();',
			TAB + 'ourWorld.live();',
			""
		].join("\n")
		
		interfaces = [
			"",
			"Interfaces",
			"",
			"Interfaces are defined by creating a new instance of the Interface object.",
			"",
			"Example:",
			TAB + 'new Interface({',
			TAB + '	type: "com.example.HelloWorld",',
			TAB + '	constructor: {',
			TAB + '		"return-value": {',
			TAB + '			type: "com.example.HelloWorld"',
			TAB + '		}',
			TAB + '	},',
			TAB + '	methods: [',
			TAB + '	{',
			TAB + '		name: "live",',
			TAB + '		interface: {',
			TAB + '			"scope": "public",',
			TAB + '		}',
			TAB + '	}',
			TAB + '	]',
			TAB + '});',
			""
		].join("\n");
		
		// 		
		// new Interface({
		// 	type: "com.example.HelloWorld",
		// 	constructor: {
		// 		'return-value': {
		// 			type: 'com.example.HelloWorld'
		// 		}
		// 	},
		// 	methods: [
		// 	{
		// 		name: "live",
		// 		interface: {
		// 			'scope': 'public',
		// 		}
		// 	}
		// 	]
		// });
		// 
		// new TypeSafeClass({
		// 	type: "com.example.HelloWorld",
		// 	implements: "com.example.HelloWorld",
		// 	constructor : function () {},
		// 	properties: {},
		// 	live: function () {
		// 		alert('hello world');
		// 	}
		// });
		// 
		// var ourWorld = new com.example.HelloWorld();
		// ourWorld.live();
		// 
=======
	</head>
	<body>
		See your console.
		<script src="typesafe.js" type="text/javascript"></script>
		<script src="generics.js" type="text/javascript"></script>
		<script src="visualizer/interfaces/com.scottbyrns.geo.Location.js" type="text/javascript"></script>
		<script type="text/javascript">
		
		new Interface({
			type: "com.scottbyrns.Visualization",
			constructor: {
				'return-value': {
					type: 'com.scottbyrns.Visualization'
				}
			},
			methods: [
				{
					name: "drawInterface",
					interface: {
						'scope': 'public',
						'input-parameters': [
							{
								name: "interface",
								type: "object"
							},
							// {
							// 	name: "location",
							// 	type: "com.scottbyrns.geo.Location"
							// }
						]
					}
				}
			]
		});
		new TypeSafeClass({
			type: 'com.scottbyrns.Visualization',
			implements: 'com.scottbyrns.Visualization',
			drawInterface: function (interface) {
				var methods = interface.methods;
				var name = interface.__objectType__;
				var constructor = interface.constructor;
				
				var html = [
					'<h1>',
					name,
					'</h1>',
					'<h2>+ ',
					'Constructor (',
				];
				
				for (var i = 0; i < constructor['input-parameters'].length; i += 1) {
					html.push("(" + constructor['input-parameters'][i].name + ")" + constructor['input-parameters'][i].type);
					html.push(", ");
				}
				html.pop();
				
				html = html.concat([
					') : ',
					constructor['return-value'].type,
					'</h2>',
					'<ul>',
				]);
				
				for (var i = 0; i < methods.length; i += 1) {
					html.push("<li>");
					var scope = methods[i].interface.scope || 'private';
					html.push(scope);
					html.push(" (" + methods[i].interface['return-value'].type + ") ");
					html.push("<strong>" + methods[i].name + "</strong> ");
					// html.push("(" + constructor['input-parameters'][i].name + ")" + constructor['input-parameters'][i].type + ", ");
					
					try {
						html.push("(");
						for (var j = 0; j < methods[i].interface['input-parameters'].length; j += 1) {
							html.push("(" + methods[i].interface['input-parameters'][j].name + ")" + constructor['input-parameters'][j].type);
							html.push(", ");
						}
						html.pop();
						html.push(")");
					}
					catch (e) {
						html.pop();
						html.push(" ()");
					}
					
					html.push("</li>");
				}
				html.push("</ul>");
				
				document.getElementsByTagName("body")[0].innerHTML = html.join("");
				
			}
		});
		
		new TypeSafeClass({
			type: 'com.scottbyrns.geo.Location',
			implements: 'com.scottbyrns.geo.Location',
			properties: [
				{name:"latitude", type:"number"},
				{name:"longitude", type:"number"}
			]
		});
		
		
		var a = new com.scottbyrns.Visualization();
		var b = new com.scottbyrns.geo.Location();
		a.drawInterface(Interface.getInterfaceNamed('com.example.Integer'));
>>>>>>> master
		</script>
	</body>
</html>